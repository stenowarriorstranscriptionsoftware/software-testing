<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
</head>
<body>
  <h2>Admin: Payment Approval</h2>
  <div id="list"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB9vruL_f9KZPC-Ihdj3UuqcXSgy1Lzqm0",
      authDomain: "score-collection.firebaseapp.com",
      databaseURL: "https://score-collection-default-rtdb.firebaseio.com",
      projectId: "score-collection",
      storageBucket: "score-collection.appspot.com",
      messagingSenderId: "720795371551",
      appId: "1:720795371551:web:78ff7863cbeaca0161ed2a",
      measurementId: "G-L6MHY1KCZ0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    auth.onAuthStateChanged(async user => {
      if (!user) {
        const email = prompt("Admin Email:");
        const password = prompt("Admin Password:");
        await auth.signInWithEmailAndPassword(email, password);
        return;
      }

      // Load pending payments
      const querySnapshot = await db.collection("users")
        .where("screenshotUploaded", "==", true)
        .where("approved", "==", false)
        .get();

      const list = document.getElementById("list");
      list.innerHTML = "";

      querySnapshot.forEach(async doc => {
        const data = doc.data();
        const div = document.createElement("div");
        div.innerHTML = `
          <p><strong>User:</strong> ${doc.id}</p>
          <button onclick="approveUser('${doc.id}')">âœ… Approve</button>
          <hr>`;
        list.appendChild(div);
      });
    });

    async function approveUser(uid) {
      const date = new Date();
      date.setDate(date.getDate() + 30);

      await db.collection("users").doc(uid).set({
        approved: true,
        paidUntil: firebase.firestore.Timestamp.fromDate(date)
      }, { merge: true });

      alert("Approved! Reload to see updates.");
      location.reload();
    }
  </script>
</body>
</html>
